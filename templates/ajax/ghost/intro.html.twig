{% extends "ajax/game/game.html.twig" %}
{% block title %}{{'Wiedergeburt: Wahl der Partie'|trans({}, 'ghost')|raw}}{% endblock %}
{% block ajax %}
    <div class="row soul">
        <div class="cell-small header rw-18 ro-3 rw-lg-20 ro-lg-2 rw-md-24 ro-md-0 edge-top-left">
            <div class="tabs">
                <div class="tab-floater">
                    <div class="tab left inline">
                        {% include "ajax/soul/playeravatar.html.twig" with {user: app.user, small: true, fallback: false} only %}
                        <h4 class="soul-name">
                            <a class="username">{{ app.user.name }}</a>
                        </h4>
                        <div class="town-join-rp hide-sm">
                            <span class="town-join-rp-head">
                                {% trans from 'ghost' %}
                                    Ein neues Leben beginnen
                                {% endtrans %}
                            </span>
                            <div class="town-join-rp-text">
                                {% trans from 'ghost' %}
                                    ...und mit 39 Mitbürgern in der Hölle schmoren
                                {% endtrans %}
                            </div>
                        </div>
                    </div>
                    <div class="tab tab-floater">
                        {% if canCreateTown %}
                            <div class="tab">
                                <div class="tab-link" x-ajax-sticky x-ajax-href="{{ path('ghost_create_town') }}"><img src="{{ asset('build/images/emotes/hero.gif') }}" alt=""/><span class="hide-md hide-sm"> {% trans from 'ghost' %}Eine Stadt gründen{% endtrans %}</span></div>
                            </div>
                            <div class="tab selected">
                                <div class="tab-link"><img src="{{ asset('build/images/icons/small_world.gif') }}" alt="" /><span class="hide-md hide-sm"> {% trans from 'ghost' %}Einer Stadt beitreten{% endtrans %}</span></div>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            {% set hasCoaInfo = warnCoaInactive or warnCoaEmpty or warnCoaNotComplete or coa is not empty %}

            <div class="relative row">
                {% if app.user|restricted(constant('App\\Entity\\AccountRestriction::RestrictionGameplayLang')) %}
                    <div {{ {cell: true, 'rw-md-12': true, 'rw-6': hasCoaInfo, 'rw-12': not hasCoaInfo}|classes }}>

                    <div class="row">
                        <div class="cell rw-12 padded">
                            <h5 class="relative">
                                {{ 'Dein Team'|trans({},'soul') }}
                            </h5>
                        </div>
                    </div>
                    <div class="row-flex">
                            {% if app.user.team is null %}
                                <div class="cell padded grow-1">
                                    <div class="note note-warning">
                                        {{ 'Du bist bisher keinem Team beigetreten.'|trans({},'ghost') }}
                                        <a x-ajax-href="{{ path('soul_settings') }}" href="#">{{ 'Team wählen'|trans({},'ghost') }}</a>
                                    </div>
                                </div>
                            {% else %}
                                <div class="cell padded grow-0 shrink-0">
                                    <span class="language"><img src="{{ asset("build/images/lang/" ~ app.user.team ~ ".png") }}" alt="{{ app.user.team }}" /></span>
                                </div>
                                <div class="cell padded grow-1 small">
                                    <strong>{{ allLangs[app.user.team].label|trans({},'global') }}</strong><br/>
                                    <i>{{ '{members} Mitglieder, {souls} verlorene Seelen'|trans({members: team_members, souls: team_souls},'ghost') }}</i>
                                </div>
                            {% endif %}
                        </div>
                </div>
                {% endif %}
                {% if hasCoaInfo %}
                    <div {{ {cell: true, 'rw-md-12': true, 'rw-6': app.user|restricted(constant('App\\Entity\\AccountRestriction::RestrictionGameplayLang')), 'rw-12': not app.user|restricted(constant('App\\Entity\\AccountRestriction::RestrictionGameplayLang'))}|classes }}>
                        <div class="row">

                        <div class="cell rw-12 padded">
                            <h5 class="relative">
                                {{ 'Koalition'|trans({},'soul') }}
                            </h5>

                            {% set coa_link = '<a href="#" x-ajax-href="' ~ path('soul_coalitions') ~ '">' ~ ('Koalition'|trans({},'soul')) ~ '</a>' %}

                            {% if warnCoaInactive %}
                                <div class="note note-critical">
                                    {{ 'Achtung: Du stehst deiner {coalition} NICHT ZUR VERFÜGUNG! Das bedeutet, dass du diese Partie allein spielen wirst.'|trans({ coalition: coa_link },'ghost')|raw }}
                                </div>
                            {% elseif warnCoaEmpty %}
                                <div class="note note-critical">
                                    {{ 'Achtung: Im Moment steht kein Mitglied deiner {coalition} zur Verfügung, um dir in eine Stadt zu folgen.'|trans({ coalition: coa_link },'ghost')|raw }}
                                </div>
                            {% elseif warnCoaNotComplete %}
                                <div class="note note-critical">
                                    {{ 'Achtung: Im Moment stehen nicht alle Mitglieder deiner {coalition} zur Verfügung, um dir in eine Stadt zu folgen.'|trans({ coalition: coa_link },'ghost')|raw }}
                                </div>
                            {% endif %}

                            {% if coa is not empty %}
                                <div class="note">
                                    {{ 'Wenn du eine Stadt betrittst, werden folgende Mitglieder deiner {coalition} dir folgen:'|trans({ coalition: coa_link },'ghost')|raw }}<br />
                                    <ul class="list no-margin">
                                        {% for member in coa %}
                                            <li><strong>{{ member.name }}</strong></li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    </div>
                {% endif %}
                {% if mayorBlock %}
                   <div class="row">
                        <div class="cell rw-12 padded">
                            <div class="note note-critical">
                                {{ 'Du kannst aktuell keinen von Spielern erstellten Städten beitreten.'|trans({},'ghost') }} {{ 'Diese Sperre endet am {date} um {time}.'|trans({ date: mayorBlock.expires|format_datetime('medium', 'none'), time: mayorBlock.expires|format_datetime('none', 'short') },'ghost')|raw }}
                            </div>
                        </div>
                   </div>
                {% endif %}
            </div>

            <div class="row">
                <div class="padded cell rw-12">
                    <div class="row">
                        <div class="cell rw-12">
                            {% if cdm_level == 2 %}

                                <div class="note note-warning">
                                    {% trans from 'ghost' %}
                                        Da du in mehreren deiner letzten Städte frühzeitig durch Verdursten gestorben bist, bist du für einige Zeit vom Spiel ausgeschlossen. Du kannst aktuell keine neue Stadt betreten.
                                    {% endtrans %}
                                </div>

                            {% else %}
                                {% if cdm_level == 1 %}
                                    <div class="note note-warning">
                                        {% trans from 'ghost' %}
                                            Du bist in mehreren deiner letzten Städte frühzeitig durch Verdursten gestorben. Sollte dies in deiner nächsten Stadt erneut geschehen, wirst du für einige Wochen vom Spiel ausgeschlossen.
                                        {% endtrans %}
                                    </div>
                                {% endif %}
                            {% endif %}

                            <div class="town-random hide-sm hide-md">
                                <div class="label row-flex v-center"><div class="padded cell">{{ 'Wähle dein nächstes Leben:'|trans({},'ghost') }}</div></div>
                            </div>

                            <hordes-game-onboarding data-lang="{{ app.user.language }}"></hordes-game-onboarding>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="cell padded rw-12">
                    <div class="small"><img alt="" src="{{ asset('build/images/icons/small_rp.gif') }}" /> {{'Beginne ein neues Leben in der Welt der Verdammten une versuche, so lang wie möglich zu überleben. Wer weiß, ws dich in dieser neuen Stadt erwarten wird?'|trans({}, 'ghost')}}</div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}