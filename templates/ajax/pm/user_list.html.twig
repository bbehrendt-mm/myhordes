{% extends "ajax/ajax_plain.html.twig" %}
{% block ajax_base %}
    <div class="row">
        <div class="padded cell rw-12">
            {% if inactive is not empty %}
                <h5>{{ 'Aktuelle Teilnehmer'|trans({},'global') }}</h5>
            {% endif %}
            <div class="row-flex wrap">
                {% for user in active %}
                    <div class="cell"><div class="pm-userbox">
                            {% if (user.avatar) %}
                                <div class="pm-avatar" style="background: url({{ path('app_web_avatar', {'uid': user.id, 'name': user.avatar.filename, 'ext': user.avatar.format}) }}) center/cover"></div>
                            {% else %}
                                <div class="pm-avatar empty"></div>
                            {% endif %}
                            <div class="pm-userbox-name">{{ user.name }}</div>
                            {% if owner %}
                                {% if user != app.user %}
                                    <div class="pm-userbox-action" x-api-call="{{ path('pm_conv_group_user_kick', {gid: gid, uid: user.id}) }}">
                                        <i class="fa fa-times-circle"></i>
                                        <div class="tooltip"><b>{{ 'Spieler ausschließen'|trans({},'global') }}</b><br />
                                            {{ 'Ausgeschlossene Spieler können die vor ihrem Ausschluss geposteten Nachrichten in der Gruppe weiterhin lesen, erhalten allerdings keine neuen Nachrichten mehr und können auch nicht mehr antworten.'|trans({},'global') }}
                                        </div>
                                    </div>
                                {% endif %}
                            {% endif %}
                        </div></div>
                {% endfor %}
            </div>

            {% if inactive is not empty %}
                <h5>{{ 'Ausgeschlossene Teilnehmer'|trans({},'global') }}</h5>
                <div class="row-flex wrap">
                    {% for user in inactive %}
                        <div class="cell"><div class="pm-userbox">
                                <div class="pm-avatar empty"></div>
                                <div class="pm-userbox-name">{{ user.name }}</div>
                                {% if owner %}
                                    <div class="pm-userbox-action" x-api-call="{{ path('pm_conv_group_user_restore', {gid: gid, uid: user.id}) }}">
                                        <i class="fa fa-plus-circle"></i>
                                        <div class="tooltip"><b>{{ 'Ausschluss annulieren'|trans({},'global') }}</b><br />
                                            {{ 'Der Ausschluss des Spielers wird annuliert und er oder sie erhält wieder vollen Zugriff auf die Gruppe.'|trans({},'global') }}
                                        </div>
                                    </div>
                                {% endif %}
                            </div></div>
                    {% endfor %}
                </div>
            {% endif %}
        </div>
    </div>

{% endblock %}
{% block js %}
    {{ parent() }}
    <script>
        (function() {
            $.html.addEventListenerAll('.pm-userbox-action[x-api-call]', 'click', function(e,elem) {
                let target = document.getElementById('pm-user-list-payload');
                if (!target) return;

                target.innerHTML = '<div style="margin: 10px" class="small center"><i class="fa fa-spin fa-circle-notch"></i> {{ 'Wird geladen...'|trans({},'global')|e('js') }}</div>';

                $.ajax.background().easySend(elem.getAttribute('x-api-call'), {}, () => {
                    $.ajax.background().load( target, '{{ path('pm_conv_group_users', {id: gid}) }}', false );
                });
            });
        })();
    </script>
{% endblock %}