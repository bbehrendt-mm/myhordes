let ruin_map_areas = document.querySelectorAll('.map');
for (let i = 0; i < ruin_map_areas.length; i++) {
    let map = ruin_map_areas[i];
    let zone_plane = map.querySelector('.zone-plane');

    const add_ruin_move_handler = function( element ) {
        if (element)
            element.addEventListener('click', function() {
                const dx = parseInt(element.getAttribute('x-direction-x'));
                const dy = parseInt(element.getAttribute('x-direction-y'));

                map.querySelector('.zone-plane-controls').classList.add('hide');
                $.ajax.easySend( '{{ path('beyond_ruin_move_controller') }}', {
                        x: dx, y: dy
                    },
                    function (data) {
                        if (data.next) {
                            let target = map.querySelector('.zone-subplane[x-plane-x="' + dx + '"][x-plane-y="' + dy + '"]');
                            if (target)
                                target.classList.add( 'plane-type-{{ prototype.explorableSkin }}-' + data.next );
                        }

                        zone_plane.style.left = (-100 + dx * -100) + '%';
                        zone_plane.style.top =  (-100 + dy *  100) + '%';
                        setTimeout(function() { $.ajax.pop_renderblock(); }, 750)
                        $.ajax.background().push_renderblock().load(null, '{{ path('exploration_dashboard') }}', true);
                    }, null, function() {
                        map.querySelector('.zone-plane-controls').classList.remove('hide');
                    } );
            });
    }

    add_ruin_move_handler( map.querySelector('.zone-plane-controls>.action-move-north') );
    add_ruin_move_handler( map.querySelector('.zone-plane-controls>.action-move-south') );
    add_ruin_move_handler( map.querySelector('.zone-plane-controls>.action-move-east')  );
    add_ruin_move_handler( map.querySelector('.zone-plane-controls>.action-move-west')  );
}